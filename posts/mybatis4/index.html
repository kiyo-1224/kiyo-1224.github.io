<!DOCTYPE html>
<html><head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="google" content="notranslate">
  <title>动态SQL与缓存 &middot; 忆遇惜·真白 的个人博客</title>
  <meta name="keywords" content="素锦, inspiration, customization, rainmeter, design, web, 壁纸, 设计, 收集, wallpaper, collection, jaku, icon">
  <meta name="description" content="世界上每个角落都有人过着相似的人生">
  <meta name="author" content="iyu_mashiro">
  <link rel="icon" type="image/png" href="">
  <link rel="stylesheet" href="/css/diaspora.css">
  <link rel="stylesheet" href="/css/insight.css">
  <link rel="stylesheet" href="/css/custom.css">
</head><body class="loading">
        <div id="loading"></div>
				<div id="nav"></div>
				<div class="nav-user"></div>
    <div id="single">
    <div id="top" style="display: block;">
        <div class="bar">
        </div>
        <a class="icon-icon" href="javascript:history.back()">
        </a>
        <div title="播放/暂停" class="icon-play">
        </div>
        
        <h3 class="subtitle" style="display: none;">
        动态SQL与缓存</h3>
        <div class="social">
            <div>
                <div class="share">
                    <a title="获取二维码" class="icon-wechat" href="javascript:;"></a>
                </div>
                <div id="qr"></div>
            </div>
        </div>
        <div class="scrollbar" style="width: 1.1636%;"></div>
    </div>
    <div class="section">
        <div class="article">
            <div>
                <h1 class="title">
                动态SQL与缓存</h1>
                <div class="stuff">
                    
                    <span>June 26, 2022</span>
                    <span>字数 3848</span>
                    
                    
                </div>
                <div class="content">
                    <h2 id="动态sql">动态SQL</h2>
<ul>
<li>Mybatis框架的动态SQL技术是一种根据特定条件动态拼装SQL语句的功能，它存在的意义是为了解决拼接SQL语句字符串时的痛点问题</li>
</ul>
<h3 id="if">if</h3>
<ul>
<li>if标签可通过test属性（即传递过来的数据）的表达式进行判断，若表达式的结果为true，则标签中的内容会执行；反之标签中的内容不会执行</li>
<li>在where后面添加一个恒成立条件<code>1=1</code>
<ul>
<li>这个恒成立条件并不会影响查询的结果</li>
<li>这个<code>1=1</code>可以用来拼接<code>and</code>语句，例如：当empName为null时
<ul>
<li>如果不加上恒成立条件，则SQL语句为<code>select * from t_emp where and age = ? and sex = ? and email = ?</code>，此时<code>where</code>会与<code>and</code>连用，SQL语句会报错</li>
<li>如果加上一个恒成立条件，则SQL语句为<code>select * from t_emp where 1= 1 and age = ? and sex = ? and email = ?</code>，此时不报错</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#75715e">&lt;!--List&lt;Emp&gt; getEmpByCondition(Emp emp);--&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;select</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;getEmpByCondition&#34;</span> <span style="color:#a6e22e">resultType=</span><span style="color:#e6db74">&#34;Emp&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>	select * from t_emp where 1=1
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&lt;if</span> <span style="color:#a6e22e">test=</span><span style="color:#e6db74">&#34;empName != null and empName !=&#39;&#39;&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>		and emp_name = #{empName}
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&lt;/if&gt;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&lt;if</span> <span style="color:#a6e22e">test=</span><span style="color:#e6db74">&#34;age != null and age !=&#39;&#39;&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>		and age = #{age}
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&lt;/if&gt;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&lt;if</span> <span style="color:#a6e22e">test=</span><span style="color:#e6db74">&#34;sex != null and sex !=&#39;&#39;&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>		and sex = #{sex}
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&lt;/if&gt;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&lt;if</span> <span style="color:#a6e22e">test=</span><span style="color:#e6db74">&#34;email != null and email !=&#39;&#39;&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>		and email = #{email}
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&lt;/if&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/select&gt;</span>
</span></span></code></pre></div><h3 id="where">where</h3>
<ul>
<li>where和if一般结合使用：
<ul>
<li>若where标签中的if条件都不满足，则where标签没有任何功能，即不会添加where关键字</li>
<li>若where标签中的if条件满足，则where标签会自动添加where关键字，并将条件最前方多余的and/or去掉</li>
</ul>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#75715e">&lt;!--List&lt;Emp&gt; getEmpByCondition(Emp emp);--&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;select</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;getEmpByCondition&#34;</span> <span style="color:#a6e22e">resultType=</span><span style="color:#e6db74">&#34;Emp&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>	select * from t_emp
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&lt;where&gt;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&lt;if</span> <span style="color:#a6e22e">test=</span><span style="color:#e6db74">&#34;empName != null and empName !=&#39;&#39;&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>			emp_name = #{empName}
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&lt;/if&gt;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&lt;if</span> <span style="color:#a6e22e">test=</span><span style="color:#e6db74">&#34;age != null and age !=&#39;&#39;&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>			and age = #{age}
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&lt;/if&gt;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&lt;if</span> <span style="color:#a6e22e">test=</span><span style="color:#e6db74">&#34;sex != null and sex !=&#39;&#39;&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>			and sex = #{sex}
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&lt;/if&gt;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&lt;if</span> <span style="color:#a6e22e">test=</span><span style="color:#e6db74">&#34;email != null and email !=&#39;&#39;&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>			and email = #{email}
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&lt;/if&gt;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&lt;/where&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/select&gt;</span>
</span></span></code></pre></div><ul>
<li>注意：where标签不能去掉条件后多余的and/or
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#75715e">&lt;!--这种用法是错误的，只能去掉条件前面的and/or，条件后面的不行--&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;if</span> <span style="color:#a6e22e">test=</span><span style="color:#e6db74">&#34;empName != null and empName !=&#39;&#39;&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>emp_name = #{empName} and
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/if&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;if</span> <span style="color:#a6e22e">test=</span><span style="color:#e6db74">&#34;age != null and age !=&#39;&#39;&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>	age = #{age}
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/if&gt;</span>
</span></span></code></pre></div><pre tabindex="0"><code></code></pre></li>
</ul>
<h3 id="trim">trim</h3>
<ul>
<li>trim用于去掉或添加标签中的内容</li>
<li>常用属性
<ul>
<li>prefix：在trim标签中的内容的前面添加某些内容</li>
<li>suffix：在trim标签中的内容的后面添加某些内容</li>
<li>prefixOverrides：在trim标签中的内容的前面去掉某些内容</li>
<li>suffixOverrides：在trim标签中的内容的后面去掉某些内容</li>
</ul>
</li>
<li>若trim中的标签都不满足条件，则trim标签没有任何效果，也就是只剩下<code>select * from t_emp</code></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#75715e">&lt;!--List&lt;Emp&gt; getEmpByCondition(Emp emp);--&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;select</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;getEmpByCondition&#34;</span> <span style="color:#a6e22e">resultType=</span><span style="color:#e6db74">&#34;Emp&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>	select * from t_emp
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&lt;trim</span> <span style="color:#a6e22e">prefix=</span><span style="color:#e6db74">&#34;where&#34;</span> <span style="color:#a6e22e">suffixOverrides=</span><span style="color:#e6db74">&#34;and|or&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&lt;if</span> <span style="color:#a6e22e">test=</span><span style="color:#e6db74">&#34;empName != null and empName !=&#39;&#39;&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>			emp_name = #{empName} and
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&lt;/if&gt;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&lt;if</span> <span style="color:#a6e22e">test=</span><span style="color:#e6db74">&#34;age != null and age !=&#39;&#39;&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>			age = #{age} and
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&lt;/if&gt;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&lt;if</span> <span style="color:#a6e22e">test=</span><span style="color:#e6db74">&#34;sex != null and sex !=&#39;&#39;&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>			sex = #{sex} or
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&lt;/if&gt;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&lt;if</span> <span style="color:#a6e22e">test=</span><span style="color:#e6db74">&#34;email != null and email !=&#39;&#39;&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>			email = #{email}
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&lt;/if&gt;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&lt;/trim&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/select&gt;</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">//测试类
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">@Test</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">getEmpByCondition</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>	SqlSession sqlSession <span style="color:#f92672">=</span> SqlSessionUtils<span style="color:#f92672">.</span><span style="color:#a6e22e">getSqlSession</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>	DynamicSQLMapper mapper <span style="color:#f92672">=</span> sqlSession<span style="color:#f92672">.</span><span style="color:#a6e22e">getMapper</span><span style="color:#f92672">(</span>DynamicSQLMapper<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>	List<span style="color:#f92672">&lt;</span>Emp<span style="color:#f92672">&gt;</span> emps<span style="color:#f92672">=</span> mapper<span style="color:#f92672">.</span><span style="color:#a6e22e">getEmpByCondition</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> Emp<span style="color:#f92672">(</span><span style="color:#66d9ef">null</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;张三&#34;</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">));</span>
</span></span><span style="display:flex;"><span>	System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>emps<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><h3 id="choosewhenotherwise">choose、when、otherwise</h3>
<ul>
<li><code>choose、when、otherwise</code>相当于<code>if...else if..else</code></li>
<li>when至少要有一个，otherwise至多只有一个</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#f92672">&lt;select</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;getEmpByChoose&#34;</span> <span style="color:#a6e22e">resultType=</span><span style="color:#e6db74">&#34;Emp&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>	select * from t_emp
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&lt;where&gt;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&lt;choose&gt;</span>
</span></span><span style="display:flex;"><span>			<span style="color:#f92672">&lt;when</span> <span style="color:#a6e22e">test=</span><span style="color:#e6db74">&#34;empName != null and empName != &#39;&#39;&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>				emp_name = #{empName}
</span></span><span style="display:flex;"><span>			<span style="color:#f92672">&lt;/when&gt;</span>
</span></span><span style="display:flex;"><span>			<span style="color:#f92672">&lt;when</span> <span style="color:#a6e22e">test=</span><span style="color:#e6db74">&#34;age != null and age != &#39;&#39;&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>				age = #{age}
</span></span><span style="display:flex;"><span>			<span style="color:#f92672">&lt;/when&gt;</span>
</span></span><span style="display:flex;"><span>			<span style="color:#f92672">&lt;when</span> <span style="color:#a6e22e">test=</span><span style="color:#e6db74">&#34;sex != null and sex != &#39;&#39;&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>				sex = #{sex}
</span></span><span style="display:flex;"><span>			<span style="color:#f92672">&lt;/when&gt;</span>
</span></span><span style="display:flex;"><span>			<span style="color:#f92672">&lt;when</span> <span style="color:#a6e22e">test=</span><span style="color:#e6db74">&#34;email != null and email != &#39;&#39;&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>				email = #{email}
</span></span><span style="display:flex;"><span>			<span style="color:#f92672">&lt;/when&gt;</span>
</span></span><span style="display:flex;"><span>			<span style="color:#f92672">&lt;otherwise&gt;</span>
</span></span><span style="display:flex;"><span>				did = 1
</span></span><span style="display:flex;"><span>			<span style="color:#f92672">&lt;/otherwise&gt;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&lt;/choose&gt;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&lt;/where&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/select&gt;</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a6e22e">@Test</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">getEmpByChoose</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>	SqlSession sqlSession <span style="color:#f92672">=</span> SqlSessionUtils<span style="color:#f92672">.</span><span style="color:#a6e22e">getSqlSession</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>	DynamicSQLMapper mapper <span style="color:#f92672">=</span> sqlSession<span style="color:#f92672">.</span><span style="color:#a6e22e">getMapper</span><span style="color:#f92672">(</span>DynamicSQLMapper<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>	List<span style="color:#f92672">&lt;</span>Emp<span style="color:#f92672">&gt;</span> emps <span style="color:#f92672">=</span> mapper<span style="color:#f92672">.</span><span style="color:#a6e22e">getEmpByChoose</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> Emp<span style="color:#f92672">(</span><span style="color:#66d9ef">null</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;张三&#34;</span><span style="color:#f92672">,</span> 23<span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;男&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;123@qq.com&#34;</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">));</span>
</span></span><span style="display:flex;"><span>	System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>emps<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><ul>
<li>相当于<code>if a else if b else if c else d</code>，只会执行其中一个</li>
</ul>
<h3 id="foreach">foreach</h3>
<ul>
<li>
<p>属性：</p>
<ul>
<li>collection：设置要循环的数组或集合</li>
<li>item：表示集合或数组中的每一个数据</li>
<li>separator：设置循环体之间的分隔符，分隔符前后默认有一个空格，如<code>,</code></li>
<li>open：设置foreach标签中的内容的开始符</li>
<li>close：设置foreach标签中的内容的结束符</li>
</ul>
</li>
<li>
<p>批量删除</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#75715e">&lt;!--int deleteMoreByArray(Integer[] eids);--&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;delete</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;deleteMoreByArray&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>	delete from t_emp where eid in
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&lt;foreach</span> <span style="color:#a6e22e">collection=</span><span style="color:#e6db74">&#34;eids&#34;</span> <span style="color:#a6e22e">item=</span><span style="color:#e6db74">&#34;eid&#34;</span> <span style="color:#a6e22e">separator=</span><span style="color:#e6db74">&#34;,&#34;</span> <span style="color:#a6e22e">open=</span><span style="color:#e6db74">&#34;(&#34;</span> <span style="color:#a6e22e">close=</span><span style="color:#e6db74">&#34;)&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>		#{eid}
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&lt;/foreach&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/delete&gt;</span>
</span></span></code></pre></div><pre tabindex="0"><code>`java
est
blic void deleteMoreByArray() {
lSession sqlSession = SqlSessionUtils.getSqlSession();
namicSQLMapper mapper = sqlSession.getMapper(DynamicSQLMapper.class);
t result = mapper.deleteMoreByArray(new Integer[]{6, 7, 8, 9});
stem.out.println(result);
</code></pre><pre tabindex="0"><code></code></pre></li>
<li>
<p>批量添加</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#75715e">&lt;!--int insertMoreByList(@Param(&#34;emps&#34;) List&lt;Emp&gt; emps);--&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;insert</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;insertMoreByList&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>	insert into t_emp values
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&lt;foreach</span> <span style="color:#a6e22e">collection=</span><span style="color:#e6db74">&#34;emps&#34;</span> <span style="color:#a6e22e">item=</span><span style="color:#e6db74">&#34;emp&#34;</span> <span style="color:#a6e22e">separator=</span><span style="color:#e6db74">&#34;,&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>		(null,#{emp.empName},#{emp.age},#{emp.sex},#{emp.email},null)
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&lt;/foreach&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/insert&gt;</span>
</span></span></code></pre></div><pre tabindex="0"><code>`java
est
blic void insertMoreByList() {
lSession sqlSession = SqlSessionUtils.getSqlSession();
namicSQLMapper mapper = sqlSession.getMapper(DynamicSQLMapper.class);
p emp1 = new Emp(null,&#34;a&#34;,1,&#34;男&#34;,&#34;123@321.com&#34;,null);
p emp2 = new Emp(null,&#34;b&#34;,1,&#34;男&#34;,&#34;123@321.com&#34;,null);
p emp3 = new Emp(null,&#34;c&#34;,1,&#34;男&#34;,&#34;123@321.com&#34;,null);
st&lt;Emp&gt; emps = Arrays.asList(emp1, emp2, emp3);
t result = mapper.insertMoreByList(emps);
stem.out.println(result);
</code></pre><pre tabindex="0"><code></code></pre></li>
</ul>
<h3 id="sql片段">SQL片段</h3>
<ul>
<li>sql片段，可以记录一段公共sql片段，在使用的地方通过include标签进行引入</li>
<li>声明sql片段：<code>&lt;sql&gt;</code>标签</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#f92672">&lt;sql</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;empColumns&#34;</span><span style="color:#f92672">&gt;</span>eid,emp_name,age,sex,email<span style="color:#f92672">&lt;/sql&gt;</span>
</span></span></code></pre></div><ul>
<li>引用sql片段：<code>&lt;include&gt;</code>标签</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#75715e">&lt;!--List&lt;Emp&gt; getEmpByCondition(Emp emp);--&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;select</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;getEmpByCondition&#34;</span> <span style="color:#a6e22e">resultType=</span><span style="color:#e6db74">&#34;Emp&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>	select <span style="color:#f92672">&lt;include</span> <span style="color:#a6e22e">refid=</span><span style="color:#e6db74">&#34;empColumns&#34;</span><span style="color:#f92672">&gt;&lt;/include&gt;</span> from t_emp
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/select&gt;</span>
</span></span></code></pre></div><h2 id="mybatis的缓存">MyBatis的缓存</h2>
<h3 id="mybatis的一级缓存">MyBatis的一级缓存</h3>
<ul>
<li>一级缓存是SqlSession级别的，通过同一个SqlSession查询的数据会被缓存，下次查询相同的数据，就会从缓存中直接获取，不会从数据库重新访问</li>
<li>使一级缓存失效的四种情况：
<ol>
<li>不同的SqlSession对应不同的一级缓存</li>
<li>同一个SqlSession但是查询条件不同</li>
<li>同一个SqlSession两次查询期间执行了任何一次增删改操作</li>
<li>同一个SqlSession两次查询期间手动清空了缓存</li>
</ol>
</li>
</ul>
<h3 id="mybatis的二级缓存">MyBatis的二级缓存</h3>
<ul>
<li>二级缓存是SqlSessionFactory级别，通过同一个SqlSessionFactory创建的SqlSession查询的结果会被缓存；此后若再次执行相同的查询语句，结果就会从缓存中获取</li>
<li>二级缓存开启的条件
<ol>
<li>在核心配置文件中，设置全局配置属性cacheEnabled=&ldquo;true&rdquo;，默认为true，不需要设置</li>
<li>在映射文件中设置标签<!-- raw HTML omitted --></li>
<li>二级缓存必须在SqlSession关闭或提交之后有效</li>
<li>查询的数据所转换的实体类类型必须实现序列化的接口</li>
</ol>
</li>
<li>使二级缓存失效的情况：两次查询之间执行了任意的增删改，会使一级和二级缓存同时失效</li>
</ul>
<h3 id="二级缓存的相关配置">二级缓存的相关配置</h3>
<ul>
<li>在mapper配置文件中添加的cache标签可以设置一些属性</li>
<li>eviction属性：缓存回收策略
<ul>
<li>LRU（Least Recently Used） – 最近最少使用的：移除最长时间不被使用的对象。</li>
<li>FIFO（First in First out） – 先进先出：按对象进入缓存的顺序来移除它们。</li>
<li>SOFT – 软引用：移除基于垃圾回收器状态和软引用规则的对象。</li>
<li>WEAK – 弱引用：更积极地移除基于垃圾收集器状态和弱引用规则的对象。</li>
<li>默认的是 LRU</li>
</ul>
</li>
<li>flushInterval属性：刷新间隔，单位毫秒
<ul>
<li>默认情况是不设置，也就是没有刷新间隔，缓存仅仅调用语句（增删改）时刷新</li>
</ul>
</li>
<li>size属性：引用数目，正整数
<ul>
<li>代表缓存最多可以存储多少个对象，太大容易导致内存溢出</li>
</ul>
</li>
<li>readOnly属性：只读，true/false
<ul>
<li>true：只读缓存；会给所有调用者返回缓存对象的相同实例。因此这些对象不能被修改。这提供了很重要的性能优势。</li>
<li>false：读写缓存；会返回缓存对象的拷贝（通过序列化）。这会慢一些，但是安全，因此默认是false</li>
</ul>
</li>
</ul>
<h3 id="mybatis缓存查询的顺序">MyBatis缓存查询的顺序</h3>
<ul>
<li>先查询二级缓存，因为二级缓存中可能会有其他程序已经查出来的数据，可以拿来直接使用</li>
<li>如果二级缓存没有命中，再查询一级缓存</li>
<li>如果一级缓存也没有命中，则查询数据库</li>
<li>SqlSession关闭之后，一级缓存中的数据会写入二级缓存</li>
</ul>
<h3 id="整合第三方缓存ehcache了解">整合第三方缓存EHCache（了解）</h3>
<h4 id="添加依赖">添加依赖</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#75715e">&lt;!-- Mybatis EHCache整合包 --&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&lt;groupId&gt;</span>org.mybatis.caches<span style="color:#f92672">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&lt;artifactId&gt;</span>mybatis-ehcache<span style="color:#f92672">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&lt;version&gt;</span>1.2.1<span style="color:#f92672">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/dependency&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">&lt;!-- slf4j日志门面的一个具体实现 --&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&lt;groupId&gt;</span>ch.qos.logback<span style="color:#f92672">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&lt;artifactId&gt;</span>logback-classic<span style="color:#f92672">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&lt;version&gt;</span>1.2.3<span style="color:#f92672">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/dependency&gt;</span>
</span></span></code></pre></div><h4 id="各个jar包的功能">各个jar包的功能</h4>
<table>
<thead>
<tr>
<th>jar包名称</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>mybatis-ehcache</td>
<td>Mybatis和EHCache的整合包</td>
</tr>
<tr>
<td>ehcache</td>
<td>EHCache核心包</td>
</tr>
<tr>
<td>slf4j-api</td>
<td>SLF4J日志门面包</td>
</tr>
<tr>
<td>logback-classic</td>
<td>支持SLF4J门面接口的一个具体实现</td>
</tr>
</tbody>
</table>
<h3 id="创建ehcache的配置文件ehcachexml">创建EHCache的配置文件ehcache.xml</h3>
<ul>
<li>名字必须叫<code>ehcache.xml</code></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#75715e">&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34; ?&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;ehcache</span> <span style="color:#a6e22e">xmlns:xsi=</span><span style="color:#e6db74">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
</span></span><span style="display:flex;"><span>         <span style="color:#a6e22e">xsi:noNamespaceSchemaLocation=</span><span style="color:#e6db74">&#34;../config/ehcache.xsd&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">&lt;!-- 磁盘保存路径 --&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;diskStore</span> <span style="color:#a6e22e">path=</span><span style="color:#e6db74">&#34;D:\atguigu\ehcache&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;defaultCache</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">maxElementsInMemory=</span><span style="color:#e6db74">&#34;1000&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">maxElementsOnDisk=</span><span style="color:#e6db74">&#34;10000000&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">eternal=</span><span style="color:#e6db74">&#34;false&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">overflowToDisk=</span><span style="color:#e6db74">&#34;true&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">timeToIdleSeconds=</span><span style="color:#e6db74">&#34;120&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">timeToLiveSeconds=</span><span style="color:#e6db74">&#34;120&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">diskExpiryThreadIntervalSeconds=</span><span style="color:#e6db74">&#34;120&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">memoryStoreEvictionPolicy=</span><span style="color:#e6db74">&#34;LRU&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;/defaultCache&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/ehcache&gt;</span>
</span></span></code></pre></div><h4 id="设置二级缓存的类型">设置二级缓存的类型</h4>
<ul>
<li>在xxxMapper.xml文件中设置二级缓存类型</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#f92672">&lt;cache</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;org.mybatis.caches.ehcache.EhcacheCache&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span></code></pre></div><h4 id="加入logback日志">加入logback日志</h4>
<ul>
<li>存在SLF4J时，作为简易日志的log4j将失效，此时我们需要借助SLF4J的具体实现logback来打印日志。创建logback的配置文件<code>logback.xml</code>，名字固定，不可改变</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#75715e">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;configuration</span> <span style="color:#a6e22e">debug=</span><span style="color:#e6db74">&#34;true&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">&lt;!-- 指定日志输出的位置 --&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;appender</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;STDOUT&#34;</span>
</span></span><span style="display:flex;"><span>              <span style="color:#a6e22e">class=</span><span style="color:#e6db74">&#34;ch.qos.logback.core.ConsoleAppender&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;encoder&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">&lt;!-- 日志输出的格式 --&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">&lt;!-- 按照顺序分别是：时间、日志级别、线程名称、打印日志的类、日志主体内容、换行 --&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;pattern&gt;</span>[%d{HH:mm:ss.SSS}] [%-5level] [%thread] [%logger] [%msg]%n<span style="color:#f92672">&lt;/pattern&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;/encoder&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;/appender&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">&lt;!-- 设置全局日志级别。日志级别按顺序分别是：DEBUG、INFO、WARN、ERROR --&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">&lt;!-- 指定任何一个日志级别都只打印当前级别和后面级别的日志。 --&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;root</span> <span style="color:#a6e22e">level=</span><span style="color:#e6db74">&#34;DEBUG&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">&lt;!-- 指定打印日志的appender，这里通过“STDOUT”引用了前面配置的appender --&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;appender-ref</span> <span style="color:#a6e22e">ref=</span><span style="color:#e6db74">&#34;STDOUT&#34;</span> <span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;/root&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">&lt;!-- 根据特殊需求指定局部日志级别 --&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;logger</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;com.atguigu.crowd.mapper&#34;</span> <span style="color:#a6e22e">level=</span><span style="color:#e6db74">&#34;DEBUG&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/configuration&gt;</span>
</span></span></code></pre></div><h4 id="ehcache配置文件说明">EHCache配置文件说明</h4>
<table>
<thead>
<tr>
<th>属性名</th>
<th>是否必须</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>maxElementsInMemory</td>
<td>是</td>
<td>在内存中缓存的element的最大数目</td>
</tr>
<tr>
<td>maxElementsOnDisk</td>
<td>是</td>
<td>在磁盘上缓存的element的最大数目，若是0表示无穷大</td>
</tr>
<tr>
<td>eternal</td>
<td>是</td>
<td>设定缓存的elements是否永远不过期。 如果为true，则缓存的数据始终有效， 如果为false那么还要根据timeToIdleSeconds、timeToLiveSeconds判断</td>
</tr>
<tr>
<td>overflowToDisk</td>
<td>是</td>
<td>设定当内存缓存溢出的时候是否将过期的element缓存到磁盘上</td>
</tr>
<tr>
<td>timeToIdleSeconds</td>
<td>否</td>
<td>当缓存在EhCache中的数据前后两次访问的时间超过timeToIdleSeconds的属性取值时， 这些数据便会删除，默认值是0,也就是可闲置时间无穷大</td>
</tr>
<tr>
<td>timeToLiveSeconds</td>
<td>否</td>
<td>缓存element的有效生命期，默认是0.,也就是element存活时间无穷大</td>
</tr>
<tr>
<td>diskSpoolBufferSizeMB</td>
<td>否</td>
<td>DiskStore(磁盘缓存)的缓存区大小。默认是30MB。每个Cache都应该有自己的一个缓冲区</td>
</tr>
<tr>
<td>diskPersistent</td>
<td>否</td>
<td>在VM重启的时候是否启用磁盘保存EhCache中的数据，默认是false</td>
</tr>
<tr>
<td>diskExpiryThreadIntervalSeconds</td>
<td>否</td>
<td>磁盘缓存的清理线程运行间隔，默认是120秒。每个120s， 相应的线程会进行一次EhCache中数据的清理工作</td>
</tr>
<tr>
<td>memoryStoreEvictionPolicy</td>
<td>否</td>
<td>当内存缓存达到最大，有新的element加入的时候， 移除缓存中element的策略。 默认是LRU（最近最少使用），可选的有LFU（最不常使用）和FIFO（先进先出</td>
</tr>
</tbody>
</table>

                    
                    <audio id="audio" loop="1" preload="auto" style="width: 100%;" controls="controls">
                        <source type="audio/mpeg" src="/mp3/Unicorn.mp3">
                        <a href="/mp3/Unicorn.mp3">/mp3/Unicorn.mp3</a>
                    </audio>
                </div>
                <div class="comment-wrap">

                </div>
            </div>
        </div>
    </div>
    <div class="relate">
        <ul>
            <h3 id="prev_next">
                <em>相 关 文 章</em>
                <span>
                    <a href="javascript: window.scrollTo(0, 0);">
                    返回顶部</a>
                    
                        <a href="http://example.org/posts/mybatis3/" rel="prev">上一篇</a>
                    
                    
                        <a href="http://example.org/posts/mybatis5/" rel="next">下一篇</a>
                    
                </span>
            </h3>
            
            
            
                
                    
                    <li>
                        <div>
                            <a class="relatea" href="http://example.org/posts/mybatis1/" title="MyBatis简介与环境搭建">
                            MyBatis简介与环境搭建</a>
                            <p>MyBatis简介与环境搭建...</p>
                        </div>
                        
                        <a href="http://example.org/posts/mybatis1/" title="MyBatis简介与环境搭建">
                            <img class="relateimg" src="/img/kano.jpg" alt="MyBatis简介与环境搭建">
                        </a>
                    </li>
                    
                
                    
                    <li>
                        <div>
                            <a class="relatea" href="http://example.org/posts/mybatis2/" title="MyBatis的增删改查">
                            MyBatis的增删改查</a>
                            <p>MyBatis的增删改查...</p>
                        </div>
                        
                        <a href="http://example.org/posts/mybatis2/" title="MyBatis的增删改查">
                            <img class="relateimg" src="/img/kano.jpg" alt="MyBatis的增删改查">
                        </a>
                    </li>
                    
                
                    
                    <li>
                        <div>
                            <a class="relatea" href="http://example.org/posts/mybatis5/" title="MyBatis的逆向工程">
                            MyBatis的逆向工程</a>
                            <p>MyBatis的逆向工程...</p>
                        </div>
                        
                        <a href="http://example.org/posts/mybatis5/" title="MyBatis的逆向工程">
                            <img class="relateimg" src="/img/kano.jpg" alt="MyBatis的逆向工程">
                        </a>
                    </li>
                    
                
                    
                
                    
                    <li>
                        <div>
                            <a class="relatea" href="http://example.org/posts/mybatis3/" title="自定义映射resultMap">
                            自定义映射resultMap</a>
                            <p>自定义映射resultMap...</p>
                        </div>
                        
                        <a href="http://example.org/posts/mybatis3/" title="自定义映射resultMap">
                            <img class="relateimg" src="/img/kano.jpg" alt="自定义映射resultMap">
                        </a>
                    </li>
                    
                
            
        </ul>
    </div>
</div>
<p style="text-align: center;">
  <a style="color: inherit" target="_blank" href="https://github.com/honjun/hugo-theme-diaspora"></a>
</p>

<script>
  var siteTitle = "忆遇惜·真白 的个人博客";
</script>
<script src="/js/jquery.min.js"></script>
<script src="/js/plugin.js"></script>
<script src="/js/diaspora.js"></script>
<script src="/js/custom.js"></script>
<script src="/js/InsightSearch.js"></script>
</body>
</html>

